<div class="map-container">
  <img src="seatmap.jpg">

  <!-- çµ„1å¯ç”¨åº§ä½ -->
  <div class="seat-zone" data-seat="93" data-allow="1" style="top:50px; left:30px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="98" data-allow="1" style="top:150px; left:30px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="105" data-allow="1" style="top:50px; left:450px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="125" data-allow="1" style="top:150px; left:450px; width:40px; height:40px;"></div>

  <!-- çµ„2 + çµ„3å¯ç”¨åº§ä½ï¼ˆå¯äº¤å‰ä½¿ç”¨ï¼‰ -->
  <div class="seat-zone" data-seat="113" data-allow="23" style="top:200px; left:300px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="114" data-allow="23" style="top:200px; left:350px; width:40px; height:40px;"></div>

  <div class="seat-zone" data-seat="121" data-allow="23" style="top:260px; left:300px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="122" data-allow="23" style="top:260px; left:350px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="123" data-allow="23" style="top:260px; left:400px; width:40px; height:40px;"></div>

  <div class="seat-zone" data-seat="129" data-allow="23" style="top:320px; left:300px; width:40px; height:40px;"></div>
  <div class="seat-zone" data-seat="130" data-allow="23" style="top:320px; left:350px; width:40px; height:40px;"></div>
</div>

const students = [
  {id:1, name:"å°ç¾Ž", group:1},
  {id:2, name:"å°å‚‘", group:2},
  {id:3, name:"é˜¿è¯", group:3},
  {id:4, name:"å°æž—", group:3},
  {id:5, name:"å°çŽ‹", group:2}
];

let remainingGroups = [...new Set(students.map(s=>s.group))];
const msg = document.getElementById("msg");

// ç”¢ç”Ÿå­¸ç”Ÿå¡
function renderStudents() {
  const box = document.getElementById("students");
  box.innerHTML = "";
  remainingGroups.forEach(g=>{
    const groupStudents = students.filter(s=>s.group===g);
    const div = document.createElement("div");
    div.className = "student";
    div.draggable = true;
    div.id = "group-"+g;
    div.innerHTML = `<b>çµ„${g}</b><br>` + groupStudents.map(s=>s.name).join(", ");
    div.ondragstart = e => e.dataTransfer.setData("group", g);
    box.appendChild(div);
  });
}
renderStudents();

// åº§ä½æ”¾ç½®
document.querySelectorAll(".seat-zone").forEach(zone=>{
  zone.addEventListener("dragover", e => e.preventDefault());
  
  zone.addEventListener("drop", e=>{
    e.preventDefault();
    const groupId = e.dataTransfer.getData("group");
    const card = document.getElementById("group-"+groupId);
    if(!card) return;

    // åº§ä½å·²è¢«ä½¿ç”¨
    if(zone.classList.contains("occupied")) {
      showMsg("âŒ é€™å€‹åº§ä½å·²ç¶“æœ‰äººäº†ï¼");
      return;
    }

    const allowed = zone.dataset.allow; // "1"ã€"23"
    
    // è¦å‰‡æª¢æŸ¥ï¼šçµ„1åªèƒ½æ”¾ 1ï¼›çµ„2/3 éƒ½å¯ä»¥æ”¾ "23"
    if(!allowed.includes(groupId)) {
      showMsg("âŒ é€™çµ„ä¸èƒ½åé€™å€‹åº§ä½ï¼");
      return;
    }

    // æˆåŠŸæ”¾ç½®
    zone.classList.add("occupied");
    card.remove();
    remainingGroups = remainingGroups.filter(x => x != groupId);
    showMsg("âœ” çµ„ " + groupId + " å®‰æŽ’æˆåŠŸï¼");

    // å…¨éƒ¨åˆ†é…å®Œæˆ
    if(remainingGroups.length === 0){
      showMsg("ðŸŽ‰ å…¨éƒ¨åˆ†çµ„æˆåŠŸå®‰æŽ’åº§ä½ï¼");
      setTimeout(()=>{
        window.location.href = "npc_question_page.html";
      }, 1800);
    }
  });
});

function showMsg(t){
  msg.innerText = t;
}
